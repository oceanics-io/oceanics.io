[build]
  base = "/"
  publish = "out"
  command = "make next"
  functions = "functions/src"

[build.environment]
  NODE_VERSION = "20"
  AWS_LAMBDA_JS_RUNTIME = "nodejs20.x"
  UV_THREADPOOL_SIZE = 16

[dev]
  port = 8888
  framework = "#static"

[[plugins]]
  package = "@netlify/plugin-csp-nonce"
  
[functions]  
  node_bundler = "esbuild"
  included_files = [
    "specification.json",
  ]
  external_node_modules = [
    "@oceanics/functions"
  ]

[[headers]]
  for = "/api/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/api"
  status = 200
  headers = {X-From = "Netlify"}

[[redirects]]
  from = "/catalog/*" 
  to = "/catalog/:splat"
  status = 200
  force = true
  conditions = { Role = ["admin"] }

[[redirects]]
  from = "/bets/*" 
  to = "/bets/:splat"
  status = 200
  force = true
  conditions = { Role = ["admin"] }