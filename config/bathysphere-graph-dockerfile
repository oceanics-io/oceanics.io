FROM python:3.7-alpine

WORKDIR bathysphere_graph
COPY openapi/api.yml ./openapi/api.yml
COPY config/bathysphere.yml ./config/bathysphere.yml
COPY config/requirements.txt ./requirements.txt
COPY bathysphere_graph ./bathysphere_graph
COPY src ./src
RUN pip install -r requirements.txt

RUN chmod +x ./src/start.sh && chmod +x ./src/pytest.sh
HEALTHCHECK --interval=30s --timeout=5s --retries=3 CMD "curl -f localhost:5000/api"
ENTRYPOINT ["./src/start.sh"]